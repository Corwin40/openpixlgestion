{% extends 'base.html.twig' %}

{% block title %}Client{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        window.onload = function(){

            // PARTIE Ajout d'une fiche service en Javascript
            // -----------------------------------------
            // Déclaration des éléments utile à la fonction
            const modalAddonClient = document.getElementById('addserviceonclient')
            // Ouverture de a modale d'édition
            modalAddonClient.addEventListener('show.bs.modal', function (event) {
                // Récupération du bouton cliqué et extraction de la variable transmise dans le data-bs-whatever
                let button = event.relatedTarget
                let idclient = button.getAttribute('data-bs-whatever')
                // Chargement du Formulaire
                let modalBody = modalAddonClient.querySelector('.modal-body')
                //console.log(modalBody)
                // on va chercher le controlleur addonclient pour afficher le formulaire
                axios
                    .get('/admin/ficheservice/addonclient/' + idclient )
                    .then(function (response) {
                        const form = document.getElementById('ModalBodyaddonclient').innerHTML = response.data.form;
                        // Ajout d'un évènement sur le click du selecteur ajout d'un service
                        document.querySelectorAll('a.btnaddonclient').forEach(function (link) {
                            link.addEventListener('click', btnaddonclient);
                        })

                        // Ajout d'un évènement sur le click de suppression service
                        document.querySelectorAll('a.btnSupprService').forEach(function (link) {
                            link.addEventListener('click', btnSupprService);
                        })

                        // Ajout d'un évènement sur le click du selecteur d'un statut
                        document.querySelectorAll('a.btnaddstatutonclient').forEach(function (link) {
                            link.addEventListener('click', btnaddstatutonclient);
                        })
                    })
                    .catch(function (error) {
                        // handle error
                        console.log(error);
                    })
                // mise à jour du lien de soumission du formulaire.
                let modalSubmit = modalAddonClient.querySelector('.modal-footer a')
                modalSubmit.href = '/admin/ficheservice/addonclient/' + idclient
            })

            // fonction d'édition de la fiche Client
            function btnaddonclient(event){
                event.preventDefault()
                let urlbtnaddonclient = this.href
                let Formbtnaddonclient = document.querySelector('.formaddonclient')
                let databtnaddonclient = new FormData(Formbtnaddonclient)
                axios
                    .post(urlbtnaddonclient, databtnaddonclient)
                    .then(function(response){
                        const liste = document.getElementById('listeficheservice').innerHTML = response.data.liste

                        // Ajout d'un évènement sur le click du selecteur ajout d'un service
                        document.querySelectorAll('a.btnaddonclient').forEach(function (link) {
                            link.addEventListener('click', btnaddonclient);
                        })

                        // Ajout d'un évènement sur le click de suppression service
                        document.querySelectorAll('a.btnSupprService').forEach(function (link) {
                            link.addEventListener('click', btnSupprService);
                        })

                        // Ajout d'un évènement sur le click du selecteur d'un statut
                        document.querySelectorAll('a.btnaddstatutonclient').forEach(function (link) {
                            link.addEventListener('click', btnaddstatutonclient);
                        })

                    })
                    .catch(function (error) {
                        console.log(error);
                    })
            }

            // PARTIE suppression d'une fiche service en Javascript
            // -----------------------------------------
            // Déclaration des éléments utile à la fonction
            const modalSupprService = document.getElementById('SupprService')
            modalSupprService.addEventListener('show.bs.modal', event => {
                // Button that triggered the modal
                const button = event.relatedTarget
                // Extract info from data-bs-* attributes
                const idfiche = button.getAttribute('data-bs-whatever')
                // If necessary, you could initiate an AJAX request here
                // and then do the updating in a callback.
                //
                // Update the modal's content.
                const modalBody = modalSupprService.querySelector('.modal-body')
                modalBody.innerHTML = "<p>Vous êtes sur le point de supprimer la fiche. <br> Etes-vous sur de vouloir continuer ?</p>"
                let modalSubmit = modalSupprService.querySelector('.modal-footer a')
                modalSubmit.href = '/admin/ficheservice/del/' + idfiche
            })

            function btnSupprService(event){
                event.preventDefault
                let url = this.href
                axios
                    .post(url)
                    .then(function(response){
                        const liste = document.getElementById('listeficheservice').innerHTML = response.data.liste

                        // Ajout d'un évènement sur le click du selecteur ajout d'un service
                        document.querySelectorAll('a.btnaddonclient').forEach(function (link) {
                            link.addEventListener('click', btnaddonclient);
                        })

                        // Ajout d'un évènement sur le click de suppression service
                        document.querySelectorAll('a.btnSupprService').forEach(function (link) {
                            link.addEventListener('click', btnSupprService);
                        })

                        // Ajout d'un évènement sur le click du selecteur d'un statut
                        document.querySelectorAll('a.btnaddstatutonclient').forEach(function (link) {
                            link.addEventListener('click', btnaddstatutonclient);
                        })

                    })
                    .catch(function (error) {
                        console.log(error);
                    })

            }

            // PARTIE Ajout d'un statut en Javascript
            // -----------------------------------------
            // Déclaration des éléments utile à la fonction
            const modaladdstatutonClient = document.getElementById('addstatutonclient')
            console.log(modaladdstatutonClient)
            // Ouverture de a modale d'édition
            modaladdstatutonClient.addEventListener('show.bs.modal', function (event) {
                // Récupération du bouton cliqué et extraction de la variable transmise dans le data-bs-whatever
                let button = event.relatedTarget
                let idficheservice = button.getAttribute('data-bs-whatever')
                // Chargement du Formulaire
                let modalBody = modaladdstatutonClient.querySelector('.modal-body')
                // on va chercher le controlleur addonclient pour afficher le formulaire
                axios
                    .get('/admin/statut/addstatutonclient/' + idficheservice )
                    .then(function (response) {
                        const form = document.getElementById('ModalBodyaddstatutonclient').innerHTML = response.data.form;
                        // Ajout d'un évènement sur le click du selecteur ajout d'un service
                        document.querySelectorAll('a.btnaddonclient').forEach(function (link) {
                            link.addEventListener('click', btnaddonclient);
                        })

                        // Ajout d'un évènement sur le click de suppression service
                        document.querySelectorAll('a.btnSupprService').forEach(function (link) {
                            link.addEventListener('click', btnSupprService);
                        })

                        // Ajout d'un évènement sur le click du selecteur d'un statut
                        document.querySelectorAll('a.btnaddstatutonclient').forEach(function (link) {
                            link.addEventListener('click', btnaddstatutonclient);
                        })
                    })
                    .catch(function (error) {
                        // handle error
                        console.log(error);
                    })
                // mise à jour du lien de soumission du formulaire.
                let modalSubmit = modaladdstatutonClient.querySelector('.modal-footer a')
                modalSubmit.href = '/admin/statut/addstatutonclient/' + idficheservice
                })

                // fonction d'édition de la fiche Client
                function btnaddstatutonclient(event){
                    event.preventDefault()
                    let urlbtnaddstatutonclient = this.href
                    let Formbtnaddstatutonclient = document.querySelector('.formaddstatutonclient')
                    let databtnaddstatutonclient = new FormData(Formbtnaddstatutonclient)
                    axios
                        .post(urlbtnaddstatutonclient, databtnaddstatutonclient)
                        .then(function(response){
                            // const liste = document.getElementById('addstatutonclient').innerHTML = response.data.liste

                            // Ajout d'un évènement sur le click du selecteur ajout d'un service
                            document.querySelectorAll('a.btnaddonclient').forEach(function (link) {
                                link.addEventListener('click', btnaddonclient);
                            })

                            // Ajout d'un évènement sur le click de suppression service
                            document.querySelectorAll('a.btnSupprService').forEach(function (link) {
                                link.addEventListener('click', btnSupprService);
                            })

                            // Ajout d'un évènement sur le click du selecteur d'un statut
                            document.querySelectorAll('a.btnaddstatutonclient').forEach(function (link) {
                                link.addEventListener('click', btnaddstatutonclient);
                            })

                        })
                        .catch(function (error) {
                            console.log(error);
                        })
                }

            // Ajout d'un évènement sur le click du selecteur ajout d'un service
            document.querySelectorAll('a.btnaddonclient').forEach(function (link) {
                link.addEventListener('click', btnaddonclient);
            })

            // Ajout d'un évènement sur le click de suppression service
            document.querySelectorAll('a.btnSupprService').forEach(function (link) {
                link.addEventListener('click', btnSupprService);
            })

            // Ajout d'un évènement sur le click du selecteur d'un statut
            document.querySelectorAll('a.btnaddstatutonclient').forEach(function (link) {
                link.addEventListener('click', btnaddstatutonclient);
            })


        }
    </script>
{% endblock %}

{% block body %}
    <section id="client_show">
        <div class="container">
            <div class="row title mt-4 mb-4">
                <div class="col-12">
                    <h1 class="text-center">Client</h1>
                    <br>
                    <div class="text-center">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="card text-center">
                        <br>
                        <h4>{{ client.typeclient }}</h4>
                        <div class="card-body text-start">
                            <p><i class="fa-solid fa-user"></i> <b>Nom & Prénom</b> : {{ client.name }} {{ client.surname }}</p>
                            <p><i class="fa-solid fa-location-dot"></i> <b>Adresse</b> : {{ client.address }}</p>
                            <p><i class="fa-solid fa-city"></i> <b>Ville</b> : {{ client.city }}</p>
                            <p><i class="fa-solid fa-globe"></i> <b>Code postal</b> : {{ client.postalCode }}</p>
                            <p><i class="fa-solid fa-phone"></i> <b>Téléphone</b> : {{ client.phone }}</p>
                            <p><i class="fa-solid fa-envelope"></i> <b>Email</b> : {{ client.email }}</p>
                            <p><i class="fa-duotone fa-clock"></i> <b>Crée le</b> : {{ client.createdAt ? client.createdAt|date('d-m-y') : '' }}</p>
                            <p><i class="fa-duotone fa-clock"></i> <b>Mise à jour</b> : {{ client.updatedAt ? client.updatedAt|date('d-m-y') : '' }}</p>
                            <a class="btn" href="{{ path('app_admin_client_edit', {'id': client.id}) }}"><i class="fa-duotone fa-pen-to-square"></i> Editer</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card text-center">
                        <div class="row">
                            <div class="col-md-12 mt-3 mb-3">
                                <button class="btn create_btn" data-bs-toggle="modal" data-bs-target="#addserviceonclient" data-bs-whatever="{{ client.id }}"><i class="fa-light fa-file-lines"></i> Ajouter un service</button>
                            </div>
                        </div>
                        {{ render(controller('App\\Controller\\Admin\\FicheServiceController::listServicesByClient', {'idclient': client.id})) }}
                    </div>
                </div>

                <div class="row text-center">
                    <div class="col-md-12">
                        <br><br>
                        <a class="btn" href="{{ path('app_admin_client_index') }}"><i class="fa-solid fa-left-to-line"></i> Retour à la liste</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section>
        <!-- Modal -->
        <div class="modal fade" id="addserviceonclient" tabindex="-1" aria-labelledby="addserviceonclient" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Crée un nouveau service</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div id="ModalBodyaddonclient" class="modal-body">
                        <p>Test</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <a id="btnaddonclient" class="btn btn-sm btn-primary btnaddonclient" data-bs-dismiss="modal">Ajouter</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal suppression de service-->
        <div class="modal fade" id="SupprService" tabindex="-1" aria-labelledby="SupprService" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Supprimer un service</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div id="ModalBodySupprService"class="modal-body">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <a class="btn btn-sm btn-primary btnSupprService" data-bs-dismiss="modal">Ajouter</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal ajout d'un statut -->
        <div class="modal fade" id="addstatutonclient" tabindex="-1" aria-labelledby="addstatutonclient" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Crée un nouveau statut</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div id="ModalBodyaddstatutonclient"class="modal-body">
                        <p>Test</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <a id="btnaddstatutonclient" class="btn btn-sm btn-primary btnaddstatutonclient" data-bs-dismiss="modal">Ajouter</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section>

    </section>




{% endblock %}